boot_beanboard.asm:
     1                              INCLUDE "asm/main.inc"
../asm/main.inc:
     1                          IFNDEF _MAIN_INC
     2                          DEFINE _MAIN_INC
     3                          
     4                          ; start of user RAM
     5                          RAMSTART equ 0x8000
     6                          
     7                          ; 8-byte status area
     8                          CONSOLE_STATUS equ 0xf000
     9                          ; 8-byte keyscan buffer
    10                          KEY_MATRIX_BUFFER equ 0xf010
    11                          ; command buffer
    12                          CMD_BUFFER equ 0xf020
    13                          ; this should really be 0x0000 as the CPU will dec SP before PUSH
    14                          STACK equ 0xffff
    15                          
    16                          UM245R_CTRL equ 0 ; serial control port
    17                          UM245R_DATA equ 1 ; serial data port
    18                          KEYSCAN_OUT equ 2 ; either 2 or 3 will work
    19                          KEYSCAN_IN  equ 3 ; either 2 or 3 will work
    20                          LCD_CTRL    equ 4 ; LCD control port
    21                          LCD_DATA    equ 5 ; LCD data port
    22                          GPIO_OUT    equ 6 ; either 6 or 7 will work
    23                          GPIO_IN     equ 7 ; either 6 or 7 will work
    24                          
    25                          CONSOLE_STATUS_USB equ 1
    26                          CONSOLE_STATUS_BEANBOARD equ 2
    27                          
    28                          ENDIF
    29                          
boot_beanboard.asm:
     2                          
     3                              EXTERN MARVIN
     4                              EXTERN PROMPT
     5                              EXTERN lcd_init
     6                              EXTERN beanboard_console_init
     7                          
     8                              ORG MARVINORG
     9  0000  31ffff                ld sp, STACK
    10  0003  cd0000                call lcd_init
    11  0006  cd0000                call beanboard_console_init
    12  0009  00000000000000    ALIGN 0x0010 ; fix the warmstart address across targets
    13                          WARMSTART:
    14  0010  c30000                jp MARVIN
    15  0013  0000000000000000  ALIGN 0x0010
              0000000000        
    16                          WARMSTART2:
    17  0020  c30000                jp PROMPT
    18                          
